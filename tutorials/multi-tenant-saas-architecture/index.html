<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.68.3"><meta name=description content="Farmer - Making repeatable Azure deployments easy!"><link rel=icon href=/farmer/images/farmer-favicon.png type=image/png><title>Multi-Tenant SaaS Architecture Patterns on Azure :: Farmer</title><link href=/farmer/css/nucleus.css?1764939373 rel=stylesheet><link href=/farmer/css/fontawesome-all.min.css?1764939373 rel=stylesheet><link href=/farmer/css/hybrid.css?1764939373 rel=stylesheet><link href=/farmer/css/featherlight.min.css?1764939373 rel=stylesheet><link href=/farmer/css/perfect-scrollbar.min.css?1764939373 rel=stylesheet><link href=/farmer/css/auto-complete.css?1764939373 rel=stylesheet><link href=/farmer/css/atom-one-dark-reasonable.css?1764939373 rel=stylesheet><link href=/farmer/css/theme.css?1764939373 rel=stylesheet><link href=/farmer/css/hugo-theme.css?1764939373 rel=stylesheet><link href=/farmer/css/theme-green.css?1764939373 rel=stylesheet><script src=/farmer/js/jquery-3.3.1.min.js?1764939373></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=/farmer/tutorials/multi-tenant-saas-architecture/><nav id=sidebar><div id=header-wrapper><div id=header><img src=/farmer/images/logo.png></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label><input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=/farmer/js/lunr.min.js?1764939373></script><script type=text/javascript src=/farmer/js/auto-complete.js?1764939373></script><script type=text/javascript>var baseurl="https:\/\/compositionalit.github.io\/farmer\/";</script><script type=text/javascript src=/farmer/js/search.js?1764939373></script></div><div class=highlightable><ul class=topics><li data-nav-id=/farmer/about/ title=About class=dd-item><a href=/farmer/about/>About</a></li><li data-nav-id=/farmer/quickstarts/ title=Quickstarts class=dd-item><a href=/farmer/quickstarts/>Quickstarts</a><ul><li data-nav-id=/farmer/quickstarts/quickstart-1/ title="Your first Farmer template" class=dd-item><a href=/farmer/quickstarts/quickstart-1/>Your first Farmer template</a></li><li data-nav-id=/farmer/quickstarts/quickstart-2/ title="Working with multiple resources" class=dd-item><a href=/farmer/quickstarts/quickstart-2/>Working with multiple resources</a></li><li data-nav-id=/farmer/quickstarts/quickstart-3/ title="Deploying to Azure" class=dd-item><a href=/farmer/quickstarts/quickstart-3/>Deploying to Azure</a></li><li data-nav-id=/farmer/quickstarts/template/ title="The Farmer .NET Template" class=dd-item><a href=/farmer/quickstarts/template/>The Farmer .NET Template</a></li></ul></li><li data-nav-id=/farmer/tutorials/ title=Tutorials class="dd-item
parent"><a href=/farmer/tutorials/>Tutorials</a><ul><li data-nav-id=/farmer/tutorials/traditional-ea/ title="Traditional Enterprise Application to the Azure Cloud, managed via Farmer" class=dd-item><a href=/farmer/tutorials/traditional-ea/>Traditional Enterprise Application to the Azure Cloud, managed via Farmer</a></li><li data-nav-id=/farmer/tutorials/webapp-deploy/ title="Deploy an ASP.NET app" class=dd-item><a href=/farmer/tutorials/webapp-deploy/>Deploy an ASP.NET app</a></li><li data-nav-id=/farmer/tutorials/multi-tenant-saas-architecture/ title="Multi-Tenant SaaS Architecture Patterns on Azure" class="dd-item active"><a href=/farmer/tutorials/multi-tenant-saas-architecture/>Multi-Tenant SaaS Architecture Patterns on Azure</a></li><li data-nav-id=/farmer/tutorials/azure-cost-optimization/ title="Azure Cost Optimization Strategies" class=dd-item><a href=/farmer/tutorials/azure-cost-optimization/>Azure Cost Optimization Strategies</a></li><li data-nav-id=/farmer/tutorials/azure-security-best-practices/ title="Azure Security Best Practices" class=dd-item><a href=/farmer/tutorials/azure-security-best-practices/>Azure Security Best Practices</a></li><li data-nav-id=/farmer/tutorials/custom-output/ title="Custom Output with ARM Expressions" class=dd-item><a href=/farmer/tutorials/custom-output/>Custom Output with ARM Expressions</a></li><li data-nav-id=/farmer/tutorials/keyvault-certs/ title="Declarative Steps in an ARM Deployment" class=dd-item><a href=/farmer/tutorials/keyvault-certs/>Declarative Steps in an ARM Deployment</a></li><li data-nav-id=/farmer/tutorials/minecraft-server-aci/ title="Create your own Minecraft Server" class=dd-item><a href=/farmer/tutorials/minecraft-server-aci/>Create your own Minecraft Server</a></li><li data-nav-id=/farmer/tutorials/aci-fsx/ title="F# Script in a Container Group" class=dd-item><a href=/farmer/tutorials/aci-fsx/>F# Script in a Container Group</a></li><li data-nav-id=/farmer/tutorials/cosmos-backed-webapp/ title="Cosmos-backed Web App" class=dd-item><a href=/farmer/tutorials/cosmos-backed-webapp/>Cosmos-backed Web App</a></li><li data-nav-id=/farmer/tutorials/multiple-web-apps/ title="Multiple web apps" class=dd-item><a href=/farmer/tutorials/multiple-web-apps/>Multiple web apps</a></li><li data-nav-id=/farmer/tutorials/serverless-etl/ title="Serverless ETL" class=dd-item><a href=/farmer/tutorials/serverless-etl/>Serverless ETL</a></li><li data-nav-id=/farmer/tutorials/web-storage-keyvault/ title="Web App Secrets with KeyVault" class=dd-item><a href=/farmer/tutorials/web-storage-keyvault/>Web App Secrets with KeyVault</a></li></ul></li><li data-nav-id=/farmer/api-overview/ title="API Overview" class=dd-item><a href=/farmer/api-overview/>API Overview</a><ul><li data-nav-id=/farmer/api-overview/template-generation/ title="Generating templates" class=dd-item><a href=/farmer/api-overview/template-generation/>Generating templates</a></li><li data-nav-id=/farmer/api-overview/expressions/ title="ARM Expressions" class=dd-item><a href=/farmer/api-overview/expressions/>ARM Expressions</a></li><li data-nav-id=/farmer/api-overview/parameters/ title="Parameters and Variables" class=dd-item><a href=/farmer/api-overview/parameters/>Parameters and Variables</a></li><li data-nav-id=/farmer/api-overview/basic-types/ title="Basic Types" class=dd-item><a href=/farmer/api-overview/basic-types/>Basic Types</a></li><li data-nav-id=/farmer/api-overview/dependencies/ title=Dependencies class=dd-item><a href=/farmer/api-overview/dependencies/>Dependencies</a></li><li data-nav-id=/farmer/api-overview/outputs/ title=Outputs class=dd-item><a href=/farmer/api-overview/outputs/>Outputs</a></li><li data-nav-id=/farmer/api-overview/resources/ title=Resources class=dd-item><a href=/farmer/api-overview/resources/>Resources</a><ul><li data-nav-id=/farmer/api-overview/resources/prometheus-rule-group/ title="Alert Management - Prometheus Rule Groups" class=dd-item><a href=/farmer/api-overview/resources/prometheus-rule-group/>Alert Management - Prometheus Rule Groups</a></li><li data-nav-id=/farmer/api-overview/resources/data-collection/ title="Azure Monitor - Data Collection" class=dd-item><a href=/farmer/api-overview/resources/data-collection/>Azure Monitor - Data Collection</a></li><li data-nav-id=/farmer/api-overview/resources/b2c-tenant/ title="B2C Tenant" class=dd-item><a href=/farmer/api-overview/resources/b2c-tenant/>B2C Tenant</a></li><li data-nav-id=/farmer/api-overview/resources/action-group/ title="App Insights - Action Group" class=dd-item><a href=/farmer/api-overview/resources/action-group/>App Insights - Action Group</a></li><li data-nav-id=/farmer/api-overview/resources/application-gateway/ title="Application Gateway" class=dd-item><a href=/farmer/api-overview/resources/application-gateway/>Application Gateway</a></li><li data-nav-id=/farmer/api-overview/resources/alert/ title="App Insights - Alerts" class=dd-item><a href=/farmer/api-overview/resources/alert/>App Insights - Alerts</a></li><li data-nav-id=/farmer/api-overview/resources/availability-tests/ title="App Insights - Availability Tests" class=dd-item><a href=/farmer/api-overview/resources/availability-tests/>App Insights - Availability Tests</a></li><li data-nav-id=/farmer/api-overview/resources/azure-firewall/ title="Azure Firewall" class=dd-item><a href=/farmer/api-overview/resources/azure-firewall/>Azure Firewall</a></li><li data-nav-id=/farmer/api-overview/resources/aks-cluster/ title="AKS Cluster" class=dd-item><a href=/farmer/api-overview/resources/aks-cluster/>AKS Cluster</a></li><li data-nav-id=/farmer/api-overview/resources/app-insights/ title="App Insights" class=dd-item><a href=/farmer/api-overview/resources/app-insights/>App Insights</a></li><li data-nav-id=/farmer/api-overview/resources/bing-search/ title="Bing Search" class=dd-item><a href=/farmer/api-overview/resources/bing-search/>Bing Search</a></li><li data-nav-id=/farmer/api-overview/resources/bastion-host/ title="Bastion Host" class=dd-item><a href=/farmer/api-overview/resources/bastion-host/>Bastion Host</a></li><li data-nav-id=/farmer/api-overview/resources/container-apps/ title="Container Apps" class=dd-item><a href=/farmer/api-overview/resources/container-apps/>Container Apps</a></li><li data-nav-id=/farmer/api-overview/resources/communication-services/ title="Communication Services" class=dd-item><a href=/farmer/api-overview/resources/communication-services/>Communication Services</a></li><li data-nav-id=/farmer/api-overview/resources/container-group/ title="Container Group" class=dd-item><a href=/farmer/api-overview/resources/container-group/>Container Group</a></li><li data-nav-id=/farmer/api-overview/resources/container-registry/ title="Container Registry" class=dd-item><a href=/farmer/api-overview/resources/container-registry/>Container Registry</a></li><li data-nav-id=/farmer/api-overview/resources/cognitive-services/ title="Cognitive Services" class=dd-item><a href=/farmer/api-overview/resources/cognitive-services/>Cognitive Services</a></li><li data-nav-id=/farmer/api-overview/resources/cosmos-db/ title="Cosmos DB" class=dd-item><a href=/farmer/api-overview/resources/cosmos-db/>Cosmos DB</a></li><li data-nav-id=/farmer/api-overview/resources/cdn/ title=CDN class=dd-item><a href=/farmer/api-overview/resources/cdn/>CDN</a></li><li data-nav-id=/farmer/api-overview/resources/dns-resolver/ title="DNS Resolver" class=dd-item><a href=/farmer/api-overview/resources/dns-resolver/>DNS Resolver</a></li><li data-nav-id=/farmer/api-overview/resources/dashboard/ title=Dashboard class=dd-item><a href=/farmer/api-overview/resources/dashboard/>Dashboard</a></li><li data-nav-id=/farmer/api-overview/resources/databricks-workspace/ title="Databricks Workspace" class=dd-item><a href=/farmer/api-overview/resources/databricks-workspace/>Databricks Workspace</a></li><li data-nav-id=/farmer/api-overview/resources/deployment-script/ title="Deployment Script" class=dd-item><a href=/farmer/api-overview/resources/deployment-script/>Deployment Script</a></li><li data-nav-id=/farmer/api-overview/resources/dns/ title="DNS Zone" class=dd-item><a href=/farmer/api-overview/resources/dns/>DNS Zone</a></li><li data-nav-id=/farmer/api-overview/resources/data-lake/ title="Data Lake" class=dd-item><a href=/farmer/api-overview/resources/data-lake/>Data Lake</a></li><li data-nav-id=/farmer/api-overview/resources/diagnosticsetting/ title="Diagnostic Settings" class=dd-item><a href=/farmer/api-overview/resources/diagnosticsetting/>Diagnostic Settings</a></li><li data-nav-id=/farmer/api-overview/resources/dedicated-hosts/ title="Dedicated Hosts" class=dd-item><a href=/farmer/api-overview/resources/dedicated-hosts/>Dedicated Hosts</a></li><li data-nav-id=/farmer/api-overview/resources/route-tables/ title="Route Tables" class=dd-item><a href=/farmer/api-overview/resources/route-tables/>Route Tables</a></li><li data-nav-id=/farmer/api-overview/resources/nat-gateway/ title="NAT Gateway" class=dd-item><a href=/farmer/api-overview/resources/nat-gateway/>NAT Gateway</a></li><li data-nav-id=/farmer/api-overview/resources/event-grid/ title="Event Grid" class=dd-item><a href=/farmer/api-overview/resources/event-grid/>Event Grid</a></li><li data-nav-id=/farmer/api-overview/resources/express-route/ title=ExpressRoute class=dd-item><a href=/farmer/api-overview/resources/express-route/>ExpressRoute</a></li><li data-nav-id=/farmer/api-overview/resources/event-hub/ title="Event Hub" class=dd-item><a href=/farmer/api-overview/resources/event-hub/>Event Hub</a></li><li data-nav-id=/farmer/api-overview/resources/network-interface/ title="Network Interface" class=dd-item><a href=/farmer/api-overview/resources/network-interface/>Network Interface</a></li><li data-nav-id=/farmer/api-overview/resources/route-server/ title="Route Server" class=dd-item><a href=/farmer/api-overview/resources/route-server/>Route Server</a></li><li data-nav-id=/farmer/api-overview/resources/functions/ title=Functions class=dd-item><a href=/farmer/api-overview/resources/functions/>Functions</a></li><li data-nav-id=/farmer/api-overview/resources/iot-hub/ title="IOT Hub" class=dd-item><a href=/farmer/api-overview/resources/iot-hub/>IOT Hub</a></li><li data-nav-id=/farmer/api-overview/resources/gallery/ title=Gallery class=dd-item><a href=/farmer/api-overview/resources/gallery/>Gallery</a></li><li data-nav-id=/farmer/api-overview/resources/image-template/ title="Image Template" class=dd-item><a href=/farmer/api-overview/resources/image-template/>Image Template</a></li><li data-nav-id=/farmer/api-overview/resources/keyvault/ title="Key Vault" class=dd-item><a href=/farmer/api-overview/resources/keyvault/>Key Vault</a></li><li data-nav-id=/farmer/api-overview/resources/private-endpoint/ title="Private Endpoint" class=dd-item><a href=/farmer/api-overview/resources/private-endpoint/>Private Endpoint</a></li><li data-nav-id=/farmer/api-overview/resources/private-link-service/ title="Private Link Service" class=dd-item><a href=/farmer/api-overview/resources/private-link-service/>Private Link Service</a></li><li data-nav-id=/farmer/api-overview/resources/logic-apps/ title="Logic Apps" class=dd-item><a href=/farmer/api-overview/resources/logic-apps/>Logic Apps</a></li><li data-nav-id=/farmer/api-overview/resources/load-balancer/ title="Load Balancer" class=dd-item><a href=/farmer/api-overview/resources/load-balancer/>Load Balancer</a></li><li data-nav-id=/farmer/api-overview/resources/loganalytics/ title="Log Analytics" class=dd-item><a href=/farmer/api-overview/resources/loganalytics/>Log Analytics</a></li><li data-nav-id=/farmer/api-overview/resources/managed-identity/ title="Managed Identity" class=dd-item><a href=/farmer/api-overview/resources/managed-identity/>Managed Identity</a></li><li data-nav-id=/farmer/api-overview/resources/maps/ title=Maps class=dd-item><a href=/farmer/api-overview/resources/maps/>Maps</a></li><li data-nav-id=/farmer/api-overview/resources/nsg/ title="Network Security Group" class=dd-item><a href=/farmer/api-overview/resources/nsg/>Network Security Group</a></li><li data-nav-id=/farmer/api-overview/resources/operations-management/ title="Operations Management" class=dd-item><a href=/farmer/api-overview/resources/operations-management/>Operations Management</a></li><li data-nav-id=/farmer/api-overview/resources/postgresql/ title=PostgreSQL class=dd-item><a href=/farmer/api-overview/resources/postgresql/>PostgreSQL</a></li><li data-nav-id=/farmer/api-overview/resources/redis/ title="Redis Cache" class=dd-item><a href=/farmer/api-overview/resources/redis/>Redis Cache</a></li><li data-nav-id=/farmer/api-overview/resources/resource-group/ title="Resource Group" class=dd-item><a href=/farmer/api-overview/resources/resource-group/>Resource Group</a></li><li data-nav-id=/farmer/api-overview/resources/signalr/ title=SignalR class=dd-item><a href=/farmer/api-overview/resources/signalr/>SignalR</a></li><li data-nav-id=/farmer/api-overview/resources/search/ title=Search class=dd-item><a href=/farmer/api-overview/resources/search/>Search</a></li><li data-nav-id=/farmer/api-overview/resources/service-bus/ title="Service Bus" class=dd-item><a href=/farmer/api-overview/resources/service-bus/>Service Bus</a></li><li data-nav-id=/farmer/api-overview/resources/sql/ title="SQL Azure" class=dd-item><a href=/farmer/api-overview/resources/sql/>SQL Azure</a></li><li data-nav-id=/farmer/api-overview/resources/static-web-app/ title="Static Web Apps" class=dd-item><a href=/farmer/api-overview/resources/static-web-app/>Static Web Apps</a></li><li data-nav-id=/farmer/api-overview/resources/storage-account/ title="Storage Account" class=dd-item><a href=/farmer/api-overview/resources/storage-account/>Storage Account</a></li><li data-nav-id=/farmer/api-overview/resources/traffic-manager/ title="Traffic Manager" class=dd-item><a href=/farmer/api-overview/resources/traffic-manager/>Traffic Manager</a></li><li data-nav-id=/farmer/api-overview/resources/virtual-machine/ title="Virtual Machine" class=dd-item><a href=/farmer/api-overview/resources/virtual-machine/>Virtual Machine</a></li><li data-nav-id=/farmer/api-overview/resources/virtual-hub/ title="Virtual Hub" class=dd-item><a href=/farmer/api-overview/resources/virtual-hub/>Virtual Hub</a></li><li data-nav-id=/farmer/api-overview/resources/vnet/ title="Virtual Network" class=dd-item><a href=/farmer/api-overview/resources/vnet/>Virtual Network</a></li><li data-nav-id=/farmer/api-overview/resources/virtual-wan/ title="Virtual WAN" class=dd-item><a href=/farmer/api-overview/resources/virtual-wan/>Virtual WAN</a></li><li data-nav-id=/farmer/api-overview/resources/vnet-gateway/ title="Virtual Network Gateway" class=dd-item><a href=/farmer/api-overview/resources/vnet-gateway/>Virtual Network Gateway</a></li><li data-nav-id=/farmer/api-overview/resources/vm-scale-set/ title="Virtual Machine Scale Set" class=dd-item><a href=/farmer/api-overview/resources/vm-scale-set/>Virtual Machine Scale Set</a></li><li data-nav-id=/farmer/api-overview/resources/disk/ title=Disk class=dd-item><a href=/farmer/api-overview/resources/disk/>Disk</a></li><li data-nav-id=/farmer/api-overview/resources/web-app/ title="Web App" class=dd-item><a href=/farmer/api-overview/resources/web-app/>Web App</a></li><li data-nav-id=/farmer/api-overview/resources/autoscale-settings/ title="Autoscale Settings" class=dd-item><a href=/farmer/api-overview/resources/autoscale-settings/>Autoscale Settings</a></li></ul></li></ul></li><li data-nav-id=/farmer/arm-vs-farmer/ title="Farmer and ARM" class=dd-item><a href=/farmer/arm-vs-farmer/>Farmer and ARM</a></li><li data-nav-id=/farmer/deployment-guidance/ title="Deployment Guidance" class=dd-item><a href=/farmer/deployment-guidance/>Deployment Guidance</a></li><li data-nav-id=/farmer/support/ title="Commercial Support" class=dd-item><a href=/farmer/support/>Commercial Support</a></li><li data-nav-id=/farmer/testimonials/ title=Testimonials class=dd-item><a href=/farmer/testimonials/>Testimonials</a></li><li data-nav-id=/farmer/links/ title=Links class=dd-item><a href=/farmer/links/>Links</a></li><li data-nav-id=/farmer/contributing/ title=Contributing class=dd-item><a href=/farmer/contributing/>Contributing</a><ul><li data-nav-id=/farmer/contributing/arm-basics/ title="ARM Basics" class=dd-item><a href=/farmer/contributing/arm-basics/>ARM Basics</a></li><li data-nav-id=/farmer/contributing/outputs-and-expressions/ title="Outputs and ARM Expressions" class=dd-item><a href=/farmer/contributing/outputs-and-expressions/>Outputs and ARM Expressions</a></li><li data-nav-id=/farmer/contributing/create-pull-requests/ title="Creating Pull Requests" class=dd-item><a href=/farmer/contributing/create-pull-requests/>Creating Pull Requests</a></li><li data-nav-id=/farmer/contributing/adding-resources/ title="Supporting a new ARM Resource" class=dd-item><a href=/farmer/contributing/adding-resources/>Supporting a new ARM Resource</a><ul><li data-nav-id=/farmer/contributing/adding-resources/1-the-farmer-pipline/ title="1. The Farmer Pipeline" class=dd-item><a href=/farmer/contributing/adding-resources/1-the-farmer-pipline/>1. The Farmer Pipeline</a></li><li data-nav-id=/farmer/contributing/adding-resources/2-iarm-resource/ title="2. The IArmResource" class=dd-item><a href=/farmer/contributing/adding-resources/2-iarm-resource/>2. The IArmResource</a></li><li data-nav-id=/farmer/contributing/adding-resources/3-ibuilder/ title="3. The IBuilder interface" class=dd-item><a href=/farmer/contributing/adding-resources/3-ibuilder/>3. The IBuilder interface</a></li><li data-nav-id=/farmer/contributing/adding-resources/4-creating-builder-syntax/ title="4. Providing Builder syntax" class=dd-item><a href=/farmer/contributing/adding-resources/4-creating-builder-syntax/>4. Providing Builder syntax</a></li><li data-nav-id=/farmer/contributing/adding-resources/5-unit-testing/ title="5. Unit Testing" class=dd-item><a href=/farmer/contributing/adding-resources/5-unit-testing/>5. Unit Testing</a></li></ul></li></ul></li><li data-nav-id=/farmer/faq/ title=FAQs class=dd-item><a href=/farmer/faq/>FAQs</a></li></ul><section id=shortcuts><h3>More</h3><ul><li><a class=padding href=https://github.com/compositionalit/farmer><i class="fab fa-fw fa-github"></i>GitHub repo</a></li><li><a class=padding href=https://www.nuget.org/packages/Farmer/><i class="fab fa-fw fa-microsoft"></i>Nuget</a></li><li><a class=padding href=https://compositional-it.com><img src=/farmer/images/cit.png></img> Compositional IT</a></li></ul></section><section id=footer></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=top-github-link><a class=github-link title="Edit this page" href=https://github.com/CompositionalIT/farmer/tree/master/docs/content/tutorials/multi-tenant-saas-architecture.md target=blank><i class="fas fa-code-branch"></i><span id=top-github-link-text>Edit this page</span></a></div><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i></a></span><span id=toc-menu><i class="fas fa-list-alt"></i></span><span class=links><a href=/farmer/>Farmer</a> > <a href=/farmer/tutorials/>Tutorials</a> > Multi-Tenant SaaS Architecture Patterns on Azure</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><a href=#multi-tenant-saas-architecture-patterns-on-azure>Multi-Tenant SaaS Architecture Patterns on Azure</a><ul><li><a href=#understanding-multi-tenancy>Understanding Multi-Tenancy</a></li><li><a href=#choosing-an-isolation-strategy>Choosing an Isolation Strategy</a></li><li><a href=#tenant-registry-and-metadata>Tenant Registry and Metadata</a></li><li><a href=#tenant-specific-configuration-with-key-vault>Tenant-Specific Configuration with Key Vault</a></li><li><a href=#application-architecture>Application Architecture</a></li><li><a href=#security-best-practices>Security Best Practices</a></li><li><a href=#cost-allocation-by-tenant>Cost Allocation by Tenant</a></li><li><a href=#tenant-provisioning-workflow>Tenant Provisioning Workflow</a></li><li><a href=#monitoring-and-observability>Monitoring and Observability</a></li><li><a href=#compliance-considerations>Compliance Considerations</a></li><li><a href=#real-world-implementation-example>Real-World Implementation Example</a></li><li><a href=#additional-resources>Additional Resources</a></li></ul></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>Multi-Tenant SaaS Architecture Patterns on Azure</h1><h2 id=multi-tenant-saas-architecture-patterns-on-azure>Multi-Tenant SaaS Architecture Patterns on Azure</h2><p>This tutorial demonstrates how to build secure, scalable multi-tenant Software-as-a-Service (SaaS) applications on Azure using Farmer. Based on Microsoft&rsquo;s SaaS Architecture guidance and battle-tested patterns from Azure customers.</p><p><strong>Note on Pricing</strong>: Cost estimates in this guide are approximate as of January 2025 in USD for the East US region. Azure pricing varies by region, currency, and billing agreements. Always verify current pricing at <a href=https://azure.microsoft.com/pricing/calculator/>https://azure.microsoft.com/pricing/calculator/</a> before making budget decisions.</p><h3 id=understanding-multi-tenancy>Understanding Multi-Tenancy</h3><p>Multi-tenancy allows a single application instance to serve multiple customers (tenants) while maintaining data isolation and security. This architecture is fundamental to modern SaaS applications.</p><p><strong>Key Requirements:</strong></p><ul><li>Data isolation between tenants</li><li>Per-tenant customization and configuration</li><li>Cost efficiency through resource sharing</li><li>Scalability for tenant growth</li><li>Security and compliance per tenant</li></ul><p>Reference: Microsoft SaaS Architecture documentation (<a href=https://learn.microsoft.com/en-us/azure/architecture/guide/multitenant/overview>https://learn.microsoft.com/en-us/azure/architecture/guide/multitenant/overview</a>)</p><h3 id=choosing-an-isolation-strategy>Choosing an Isolation Strategy</h3><p>Azure supports three primary isolation strategies. The choice depends on tenant count, data sensitivity, and cost constraints.</p><h4 id=strategy-1-schema-per-tenant-database-shared>Strategy 1: Schema-per-Tenant (Database Shared)</h4><p>Use Azure SQL Database with schemas for logical isolation. Best for 100-1000+ tenants with moderate isolation requirements.</p><p><strong>Advantages:</strong></p><ul><li>Cost-efficient (single database serves all tenants)</li><li>Easy to deploy and manage</li><li>Scales to thousands of tenants</li><li>Simplified backup and monitoring</li></ul><p><strong>Disadvantages:</strong></p><ul><li>Limited physical isolation</li><li>Noisy neighbor potential</li><li>Complex query patterns needed for isolation</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fsharp data-lang=fsharp><span style=color:#66d9ef>open</span> Farmer
<span style=color:#66d9ef>open</span> Farmer.Builders
<span style=color:#66d9ef>open</span> Sql

<span style=color:#66d9ef>let</span> multiTenantDatabase <span style=color:#f92672>=</span> sqlServer <span style=color:#f92672>{</span>
    name <span style=color:#e6db74>&#34;multitenant-sql-server&#34;</span>
    admin_username <span style=color:#e6db74>&#34;sqladmin&#34;</span>
    
    add_databases <span style=color:#f92672>[</span>
        sqlDb <span style=color:#f92672>{</span>
            name <span style=color:#e6db74>&#34;shared-tenant-db&#34;</span>
            sku <span style=color:#f92672>(</span>GeneralPurpose Gen5_4<span style=color:#f92672>)</span>  <span style=color:#75715e>// 4 vCores for multi-tenant
</span><span style=color:#75715e></span>        <span style=color:#f92672>}</span>
    <span style=color:#f92672>]</span>
    
    <span style=color:#75715e>// Enable Azure services access for tenant isolation auditing
</span><span style=color:#75715e></span>    enable_azure_firewall
<span style=color:#f92672>}</span>
</code></pre></div><p><strong>Implementing Row-Level Security (RLS):</strong></p><p>After deploying with Farmer, configure RLS using T-SQL:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#75715e>-- Create schema per tenant
</span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>SCHEMA</span> TenantA;
<span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>SCHEMA</span> TenantB;

<span style=color:#75715e>-- Create table in each schema
</span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> TenantA.Orders (
    OrderId INT <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span>,
    CustomerId INT,
    OrderDate DATETIME
);

<span style=color:#75715e>-- Enable Row Level Security
</span><span style=color:#75715e></span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>TABLE</span> TenantA.Orders ENABLE <span style=color:#66d9ef>ROW</span> <span style=color:#66d9ef>LEVEL</span> <span style=color:#66d9ef>SECURITY</span>;

<span style=color:#75715e>-- Create security policy
</span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>FUNCTION</span> TenantA.fn_securitypredicate(<span style=color:#f92672>@</span>TenantId INT)
<span style=color:#66d9ef>RETURNS</span> <span style=color:#66d9ef>TABLE</span>
<span style=color:#66d9ef>WITH</span> SCHEMABINDING
<span style=color:#66d9ef>AS</span>
<span style=color:#66d9ef>RETURN</span> <span style=color:#66d9ef>SELECT</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>AS</span> fn_securitypredicate_result
<span style=color:#66d9ef>WHERE</span> <span style=color:#f92672>@</span>TenantId <span style=color:#f92672>=</span> <span style=color:#66d9ef>CAST</span>(SESSION_CONTEXT(N<span style=color:#e6db74>&#39;TenantId&#39;</span>) <span style=color:#66d9ef>AS</span> INT);

<span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>SECURITY</span> POLICY TenantA.tenantSecurityPolicy
<span style=color:#66d9ef>ADD</span> FILTER PREDICATE TenantA.fn_securitypredicate(TenantId) <span style=color:#66d9ef>ON</span> TenantA.Orders
<span style=color:#66d9ef>WITH</span> (<span style=color:#66d9ef>STATE</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>ON</span>);
</code></pre></div><p>Reference: Azure SQL Row-Level Security (<a href=https://learn.microsoft.com/en-us/sql/relational-databases/security/row-level-security>https://learn.microsoft.com/en-us/sql/relational-databases/security/row-level-security</a>)</p><h4 id=strategy-2-database-per-tenant>Strategy 2: Database-per-Tenant</h4><p>Dedicate entire database to each tenant. Best for &lt;100 enterprise tenants with strict isolation needs.</p><p><strong>Advantages:</strong></p><ul><li>Complete data isolation</li><li>Independent scaling per tenant</li><li>Simplified compliance (per-tenant encryption keys)</li><li>Easy to migrate tenants between servers</li></ul><p><strong>Disadvantages:</strong></p><ul><li>Higher costs (multiple databases)</li><li>More complex management</li><li>Backup and monitoring overhead</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fsharp data-lang=fsharp><span style=color:#66d9ef>open</span> Sql

<span style=color:#75715e>// Function to create database for new tenant
</span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> createTenantDatabase <span style=color:#f92672>(</span>tenantName<span style=color:#f92672>:</span> <span style=color:#66d9ef>string</span><span style=color:#f92672>)</span> <span style=color:#f92672>=</span> 
    sqlDb <span style=color:#f92672>{</span>
        name <span style=color:#f92672>(</span>sprintf <span style=color:#e6db74>&#34;tenant-%s-db&#34;</span> tenantName<span style=color:#f92672>)</span>
        sku DtuSku.S1  <span style=color:#75715e>// Start small, scale per tenant
</span><span style=color:#75715e></span>    <span style=color:#f92672>}</span>

<span style=color:#75715e>// Multi-tenant SQL Server with tenant-specific databases
</span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> enterpriseMultiTenantServer <span style=color:#f92672>=</span> sqlServer <span style=color:#f92672>{</span>
    name <span style=color:#e6db74>&#34;enterprise-tenant-server&#34;</span>
    admin_username <span style=color:#e6db74>&#34;tenantadmin&#34;</span>
    
    add_databases <span style=color:#f92672>[</span>
        createTenantDatabase <span style=color:#e6db74>&#34;acme-corp&#34;</span>
        createTenantDatabase <span style=color:#e6db74>&#34;globex-inc&#34;</span>
        createTenantDatabase <span style=color:#e6db74>&#34;initech-llc&#34;</span>
    <span style=color:#f92672>]</span>
    
    <span style=color:#75715e>// Elastic pool for cost optimization across tenant databases
</span><span style=color:#75715e></span>    elastic_pool_name <span style=color:#e6db74>&#34;tenant-pool&#34;</span>
    elastic_pool_sku PoolSku.Standard400  <span style=color:#75715e>// 400 eDTUs shared
</span><span style=color:#75715e></span><span style=color:#f92672>}</span>
</code></pre></div><p><strong>Cost Optimization with Elastic Pools:</strong></p><p>According to Microsoft&rsquo;s SaaS patterns, elastic pools reduce costs by 30-50% for database-per-tenant architectures.</p><table><thead><tr><th>Approach</th><th>Cost (10 tenants)</th><th>Cost (50 tenants)</th></tr></thead><tbody><tr><td>Individual S1 databases</td><td>$300/month</td><td>$1,500/month</td></tr><tr><td>Elastic Pool (400 eDTUs)</td><td>$240/month</td><td>$240/month</td></tr><tr><td><strong>Savings</strong></td><td><strong>20%</strong></td><td><strong>84%</strong></td></tr></tbody></table><h4 id=strategy-3-hybrid-approach>Strategy 3: Hybrid Approach</h4><p>Combine strategies: Small tenants share schema, enterprise tenants get dedicated databases.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fsharp data-lang=fsharp><span style=color:#66d9ef>open</span> Sql

<span style=color:#75715e>// Shared database for small/medium tenants
</span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> sharedServer <span style=color:#f92672>=</span> sqlServer <span style=color:#f92672>{</span>
    name <span style=color:#e6db74>&#34;shared-tenants-server&#34;</span>
    admin_username <span style=color:#e6db74>&#34;sharedadmin&#34;</span>
    
    add_databases <span style=color:#f92672>[</span>
        sqlDb <span style=color:#f92672>{</span>
            name <span style=color:#e6db74>&#34;shared-tenants-db&#34;</span>
            sku <span style=color:#f92672>(</span>GeneralPurpose Gen5_8<span style=color:#f92672>)</span>  <span style=color:#75715e>// 8 vCores
</span><span style=color:#75715e></span>        <span style=color:#f92672>}</span>
    <span style=color:#f92672>]</span>
<span style=color:#f92672>}</span>

<span style=color:#75715e>// Dedicated server for enterprise tenants
</span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> enterpriseServer <span style=color:#f92672>=</span> sqlServer <span style=color:#f92672>{</span>
    name <span style=color:#e6db74>&#34;enterprise-tenants-server&#34;</span>
    admin_username <span style=color:#e6db74>&#34;enterpriseadmin&#34;</span>
    
    add_databases <span style=color:#f92672>[</span>
        createTenantDatabase <span style=color:#e6db74>&#34;fortune500-client&#34;</span>
    <span style=color:#f92672>]</span>
<span style=color:#f92672>}</span>

<span style=color:#66d9ef>let</span> hybridMultiTenantArchitecture <span style=color:#f92672>=</span> arm <span style=color:#f92672>{</span>
    location Location.EastUS
    add_resources <span style=color:#f92672>[</span>
        sharedServer
        enterpriseServer
    <span style=color:#f92672>]</span>
<span style=color:#f92672>}</span>
</code></pre></div><h3 id=tenant-registry-and-metadata>Tenant Registry and Metadata</h3><p>Maintain a central tenant registry using Cosmos DB for global distribution and low latency.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fsharp data-lang=fsharp><span style=color:#66d9ef>open</span> Farmer.CosmosDb

<span style=color:#66d9ef>let</span> tenantRegistry <span style=color:#f92672>=</span> cosmosDb <span style=color:#f92672>{</span>
    name <span style=color:#e6db74>&#34;tenant-registry&#34;</span>
    account_name <span style=color:#e6db74>&#34;saas-tenants&#34;</span>
    
    <span style=color:#75715e>// Partition by tenant ID for efficient queries
</span><span style=color:#75715e></span>    add_containers <span style=color:#f92672>[</span>
        cosmosContainer <span style=color:#f92672>{</span>
            name <span style=color:#e6db74>&#34;tenants&#34;</span>
            partition_key <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;/tenantId&#34;</span> <span style=color:#f92672>]</span> Hash
        <span style=color:#f92672>}</span>
        cosmosContainer <span style=color:#f92672>{</span>
            name <span style=color:#e6db74>&#34;tenant-configurations&#34;</span>
            partition_key <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;/tenantId&#34;</span> <span style=color:#f92672>]</span> Hash
        <span style=color:#f92672>}</span>
    <span style=color:#f92672>]</span>
    
    consistency_policy Session
    throughput 400<span style=color:#f92672>&lt;</span>CosmosDb.RU<span style=color:#f92672>&gt;</span>
<span style=color:#f92672>}</span>
</code></pre></div><p><strong>Tenant Registry Schema:</strong></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
  <span style=color:#f92672>&#34;tenantId&#34;</span>: <span style=color:#e6db74>&#34;acme-corp&#34;</span>,
  <span style=color:#f92672>&#34;tenantName&#34;</span>: <span style=color:#e6db74>&#34;Acme Corporation&#34;</span>,
  <span style=color:#f92672>&#34;tier&#34;</span>: <span style=color:#e6db74>&#34;enterprise&#34;</span>,
  <span style=color:#f92672>&#34;status&#34;</span>: <span style=color:#e6db74>&#34;active&#34;</span>,
  <span style=color:#f92672>&#34;createdDate&#34;</span>: <span style=color:#e6db74>&#34;2025-01-01T00:00:00Z&#34;</span>,
  <span style=color:#f92672>&#34;databaseConnection&#34;</span>: <span style=color:#e6db74>&#34;enterprise-tenants-server&#34;</span>,
  <span style=color:#f92672>&#34;databaseName&#34;</span>: <span style=color:#e6db74>&#34;tenant-acme-corp-db&#34;</span>,
  <span style=color:#f92672>&#34;features&#34;</span>: [<span style=color:#e6db74>&#34;advanced-reporting&#34;</span>, <span style=color:#e6db74>&#34;api-access&#34;</span>],
  <span style=color:#f92672>&#34;billingPlan&#34;</span>: <span style=color:#e6db74>&#34;enterprise-annual&#34;</span>,
  <span style=color:#f92672>&#34;customDomain&#34;</span>: <span style=color:#e6db74>&#34;acme.app.example.com&#34;</span>
}
</code></pre></div><h3 id=tenant-specific-configuration-with-key-vault>Tenant-Specific Configuration with Key Vault</h3><p>Store per-tenant secrets and configuration in Azure Key Vault with tenant-scoped access policies.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fsharp data-lang=fsharp><span style=color:#66d9ef>open</span> Farmer.KeyVault

<span style=color:#75715e>// Function to create tenant-specific Key Vault
</span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> createTenantKeyVault <span style=color:#f92672>(</span>tenantId<span style=color:#f92672>:</span> <span style=color:#66d9ef>string</span><span style=color:#f92672>)</span> <span style=color:#f92672>=</span>
    keyVault <span style=color:#f92672>{</span>
        name <span style=color:#f92672>(</span>sprintf <span style=color:#e6db74>&#34;tenant-%s-secrets&#34;</span> tenantId<span style=color:#f92672>)</span>
        sku Sku.Standard
        
        <span style=color:#75715e>// Tenant-specific secrets (values should come from secure parameters)
</span><span style=color:#75715e></span>        add_secret <span style=color:#f92672>(</span>sprintf <span style=color:#e6db74>&#34;api-key-%s&#34;</span> tenantId<span style=color:#f92672>)</span>
        add_secret <span style=color:#f92672>(</span>sprintf <span style=color:#e6db74>&#34;encryption-key-%s&#34;</span> tenantId<span style=color:#f92672>)</span>
        add_secret <span style=color:#f92672>(</span>sprintf <span style=color:#e6db74>&#34;integration-token-%s&#34;</span> tenantId<span style=color:#f92672>)</span>
        
        enable_soft_delete_with_purge_protection
    <span style=color:#f92672>}</span>

<span style=color:#66d9ef>let</span> acmeVault <span style=color:#f92672>=</span> createTenantKeyVault <span style=color:#e6db74>&#34;acme-corp&#34;</span>
<span style=color:#66d9ef>let</span> globexVault <span style=color:#f92672>=</span> createTenantKeyVault <span style=color:#e6db74>&#34;globex-inc&#34;</span>
<span style=color:#66d9ef>let</span> initechVault <span style=color:#f92672>=</span> createTenantKeyVault <span style=color:#e6db74>&#34;initech-llc&#34;</span>

<span style=color:#66d9ef>let</span> tenantSecrets <span style=color:#f92672>=</span> arm <span style=color:#f92672>{</span>
    location Location.EastUS
    add_resources <span style=color:#f92672>[</span>
        acmeVault
        globexVault
        initechVault
    <span style=color:#f92672>]</span>
<span style=color:#f92672>}</span>
</code></pre></div><h3 id=application-architecture>Application Architecture</h3><p>Build tenant-aware applications using Azure App Service with tenant context middleware.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fsharp data-lang=fsharp><span style=color:#75715e>// App Service Plan scaled for multi-tenant load
</span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> appPlan <span style=color:#f92672>=</span> servicePlan <span style=color:#f92672>{</span>
    name <span style=color:#e6db74>&#34;multitenant-plan&#34;</span>
    sku WebApp.Sku.P1V3  <span style=color:#75715e>// Premium for production multi-tenant
</span><span style=color:#75715e></span>    number_of_workers 3
<span style=color:#f92672>}</span>

<span style=color:#75715e>// Application insights for monitoring
</span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> mtInsights <span style=color:#f92672>=</span> appInsights <span style=color:#f92672>{</span>
    name <span style=color:#e6db74>&#34;multitenant-insights&#34;</span>
<span style=color:#f92672>}</span>

<span style=color:#75715e>// Main application
</span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> mtApp <span style=color:#f92672>=</span> webApp <span style=color:#f92672>{</span>
    name <span style=color:#e6db74>&#34;multitenant-webapp&#34;</span>
    link_to_service_plan appPlan
    always_on
    https_only
    link_to_app_insights mtInsights<span style=color:#f92672>.</span>Name
    
    <span style=color:#75715e>// Connection to tenant registry
</span><span style=color:#75715e></span>    setting <span style=color:#e6db74>&#34;CosmosDbEndpoint&#34;</span> tenantRegistry<span style=color:#f92672>.</span>Endpoint
    setting <span style=color:#e6db74>&#34;CosmosDbKey&#34;</span> tenantRegistry<span style=color:#f92672>.</span>PrimaryKey
<span style=color:#f92672>}</span>

<span style=color:#66d9ef>let</span> multiTenantWebApp <span style=color:#f92672>=</span> arm <span style=color:#f92672>{</span>
    location Location.EastUS
    add_resources <span style=color:#f92672>[</span>
        appPlan
        tenantRegistry
        mtInsights
        mtApp
    <span style=color:#f92672>]</span>
<span style=color:#f92672>}</span>
</code></pre></div><p><strong>Tenant Context Middleware (F# example with Giraffe):</strong></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fsharp data-lang=fsharp><span style=color:#66d9ef>open</span> Giraffe
<span style=color:#66d9ef>open</span> Microsoft.AspNetCore.Http
<span style=color:#66d9ef>open</span> System.Threading.Tasks

<span style=color:#66d9ef>type</span> <span style=color:#a6e22e>ITenantRegistry</span> <span style=color:#f92672>=</span>
    <span style=color:#66d9ef>abstract</span> GetTenantAsync<span style=color:#f92672>:</span> <span style=color:#66d9ef>string</span> <span style=color:#f92672>-&gt;</span> Task<span style=color:#f92672>&lt;</span>Tenant option<span style=color:#f92672>&gt;</span>

<span style=color:#66d9ef>let</span> tenantMiddleware <span style=color:#f92672>(</span>registry<span style=color:#f92672>:</span> ITenantRegistry<span style=color:#f92672>)</span> <span style=color:#f92672>:</span> HttpHandler <span style=color:#f92672>=</span>
    <span style=color:#66d9ef>fun</span> <span style=color:#f92672>(</span>next<span style=color:#f92672>:</span> HttpFunc<span style=color:#f92672>)</span> <span style=color:#f92672>(</span>ctx<span style=color:#f92672>:</span> HttpContext<span style=color:#f92672>)</span> <span style=color:#f92672>-&gt;</span> task <span style=color:#f92672>{</span>
        <span style=color:#75715e>// Extract tenant from subdomain: acme.app.example.com
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>let</span> host <span style=color:#f92672>=</span> ctx<span style=color:#f92672>.</span>Request<span style=color:#f92672>.</span>Host<span style=color:#f92672>.</span>Host
        <span style=color:#66d9ef>let</span> tenantId <span style=color:#f92672>=</span> host<span style=color:#f92672>.</span>Split<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;.&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>|&gt;</span> Array.tryHead <span style=color:#f92672>|&gt;</span> Option.defaultValue <span style=color:#e6db74>&#34;&#34;</span>
        
        <span style=color:#75715e>// Resolve tenant configuration
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>let!</span> tenant <span style=color:#f92672>=</span> registry<span style=color:#f92672>.</span>GetTenantAsync<span style=color:#f92672>(</span>tenantId<span style=color:#f92672>)</span>
        
        <span style=color:#66d9ef>match</span> tenant <span style=color:#66d9ef>with</span>
        <span style=color:#f92672>|</span> None <span style=color:#f92672>-&gt;</span> 
            ctx<span style=color:#f92672>.</span>Response<span style=color:#f92672>.</span>StatusCode <span style=color:#f92672>&lt;-</span> 404
            <span style=color:#66d9ef>return</span><span style=color:#f92672>!</span> Task.FromResult None
        <span style=color:#f92672>|</span> Some tenant <span style=color:#f92672>-&gt;</span>
            <span style=color:#75715e>// Set tenant context for request
</span><span style=color:#75715e></span>            ctx<span style=color:#f92672>.</span>Items<span style=color:#f92672>.[</span><span style=color:#e6db74>&#34;TenantId&#34;</span><span style=color:#f92672>]</span> <span style=color:#f92672>&lt;-</span> box tenant<span style=color:#f92672>.</span>TenantId
            ctx<span style=color:#f92672>.</span>Items<span style=color:#f92672>.[</span><span style=color:#e6db74>&#34;TenantConfig&#34;</span><span style=color:#f92672>]</span> <span style=color:#f92672>&lt;-</span> box tenant
            <span style=color:#66d9ef>return</span><span style=color:#f92672>!</span> next ctx
    <span style=color:#f92672>}</span>
</code></pre></div><h3 id=security-best-practices>Security Best Practices</h3><p>Implement defense-in-depth for multi-tenant security, following Microsoft Security Best Practices.</p><h4 id=prevent-cross-tenant-data-leaks>Prevent Cross-Tenant Data Leaks</h4><p><strong>Always include tenant context in queries:</strong></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fsharp data-lang=fsharp><span style=color:#75715e>// ❌ BAD: No tenant filtering
</span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> getOrder <span style=color:#f92672>(</span>ctx<span style=color:#f92672>:</span> HttpContext<span style=color:#f92672>)</span> <span style=color:#f92672>(</span>orderId<span style=color:#f92672>:</span> Guid<span style=color:#f92672>)</span> <span style=color:#f92672>=</span> task <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>let!</span> order <span style=color:#f92672>=</span> dbContext<span style=color:#f92672>.</span>Orders
                 <span style=color:#f92672>|&gt;</span> Seq.filter <span style=color:#f92672>(</span><span style=color:#66d9ef>fun</span> o <span style=color:#f92672>-&gt;</span> o<span style=color:#f92672>.</span>OrderId <span style=color:#f92672>=</span> orderId<span style=color:#f92672>)</span>
                 <span style=color:#f92672>|&gt;</span> Seq.tryHead
    <span style=color:#66d9ef>return</span> order
<span style=color:#f92672>}</span>

<span style=color:#75715e>// ✅ GOOD: Tenant context enforced
</span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> getOrder <span style=color:#f92672>(</span>ctx<span style=color:#f92672>:</span> HttpContext<span style=color:#f92672>)</span> <span style=color:#f92672>(</span>orderId<span style=color:#f92672>:</span> Guid<span style=color:#f92672>)</span> <span style=color:#f92672>=</span> task <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>let</span> tenantId <span style=color:#f92672>=</span> ctx<span style=color:#f92672>.</span>Items<span style=color:#f92672>.[</span><span style=color:#e6db74>&#34;TenantId&#34;</span><span style=color:#f92672>]</span> <span style=color:#f92672>:?&gt;</span> <span style=color:#66d9ef>string</span>
    <span style=color:#66d9ef>let!</span> order <span style=color:#f92672>=</span> dbContext<span style=color:#f92672>.</span>Orders
                 <span style=color:#f92672>|&gt;</span> Seq.filter <span style=color:#f92672>(</span><span style=color:#66d9ef>fun</span> o <span style=color:#f92672>-&gt;</span> o<span style=color:#f92672>.</span>TenantId <span style=color:#f92672>=</span> tenantId <span style=color:#f92672>&amp;&amp;</span> o<span style=color:#f92672>.</span>OrderId <span style=color:#f92672>=</span> orderId<span style=color:#f92672>)</span>
                 <span style=color:#f92672>|&gt;</span> Seq.tryHead
    <span style=color:#66d9ef>return</span> order
<span style=color:#f92672>}</span>
</code></pre></div><h4 id=enable-audit-logging-per-tenant>Enable Audit Logging per Tenant</h4><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fsharp data-lang=fsharp><span style=color:#66d9ef>let</span> tenantAuditLog <span style=color:#f92672>=</span> appInsights <span style=color:#f92672>{</span>
    name <span style=color:#e6db74>&#34;tenant-audit-logs&#34;</span>
    retention_days 90  <span style=color:#75715e>// Compliance requirement
</span><span style=color:#75715e></span>    
    <span style=color:#75715e>// Custom dimensions for tenant tracking
</span><span style=color:#75715e></span>    <span style=color:#75715e>// Configure in application code
</span><span style=color:#75715e></span><span style=color:#f92672>}</span>
</code></pre></div><p><strong>Log tenant context in Application Insights:</strong></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fsharp data-lang=fsharp><span style=color:#66d9ef>open</span> Microsoft.ApplicationInsights
<span style=color:#66d9ef>open</span> System.Collections.Generic

<span style=color:#66d9ef>let</span> logOrderCreated <span style=color:#f92672>(</span>telemetry<span style=color:#f92672>:</span> TelemetryClient<span style=color:#f92672>)</span> tenantId orderId userId <span style=color:#f92672>=</span>
    <span style=color:#66d9ef>let</span> properties <span style=color:#f92672>=</span> Dictionary<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>string</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>string</span><span style=color:#f92672>&gt;</span>()
    properties<span style=color:#f92672>.[</span><span style=color:#e6db74>&#34;TenantId&#34;</span><span style=color:#f92672>]</span> <span style=color:#f92672>&lt;-</span> tenantId
    properties<span style=color:#f92672>.[</span><span style=color:#e6db74>&#34;OrderId&#34;</span><span style=color:#f92672>]</span> <span style=color:#f92672>&lt;-</span> orderId<span style=color:#f92672>.</span>ToString()
    properties<span style=color:#f92672>.[</span><span style=color:#e6db74>&#34;UserId&#34;</span><span style=color:#f92672>]</span> <span style=color:#f92672>&lt;-</span> userId
    telemetry<span style=color:#f92672>.</span>TrackEvent<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;OrderCreated&#34;</span><span style=color:#f92672>,</span> properties<span style=color:#f92672>)</span>
</code></pre></div><h3 id=cost-allocation-by-tenant>Cost Allocation by Tenant</h3><p>Implement chargeback using Azure Cost Management and resource tagging.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fsharp data-lang=fsharp><span style=color:#75715e>// Tag all tenant resources for cost allocation
</span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> taggedTenantResources <span style=color:#f92672>=</span> arm <span style=color:#f92672>{</span>
    location Location.EastUS
    
    add_resources <span style=color:#f92672>[</span>
        sqlServer <span style=color:#f92672>{</span>
            name <span style=color:#e6db74>&#34;tenant-acme-server&#34;</span>
            add_tags <span style=color:#f92672>[</span>
                <span style=color:#e6db74>&#34;TenantId&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;acme-corp&#34;</span>
                <span style=color:#e6db74>&#34;CostCenter&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;acme-billing&#34;</span>
                <span style=color:#e6db74>&#34;Tier&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;enterprise&#34;</span>
            <span style=color:#f92672>]</span>
            add_databases <span style=color:#f92672>[</span> <span style=color:#f92672>/*</span> <span style=color:#f92672>...</span> <span style=color:#f92672>*/</span> <span style=color:#f92672>]</span>
        <span style=color:#f92672>}</span>
    <span style=color:#f92672>]</span>
<span style=color:#f92672>}</span>
</code></pre></div><p><strong>Cost Allocation by Tier:</strong></p><table><thead><tr><th>Tier</th><th>Shared Resources</th><th>Dedicated Resources</th><th>Monthly Cost</th></tr></thead><tbody><tr><td>Free</td><td>Shared DB schema</td><td>None</td><td>$0 (subsidized)</td></tr><tr><td>Standard</td><td>Shared DB schema</td><td>None</td><td>$10-25/tenant</td></tr><tr><td>Premium</td><td>Shared DB schema</td><td>Dedicated Key Vault</td><td>$50-100/tenant</td></tr><tr><td>Enterprise</td><td>Dedicated database</td><td>Dedicated server, Key Vault</td><td>$500-2000/tenant</td></tr></tbody></table><h3 id=tenant-provisioning-workflow>Tenant Provisioning Workflow</h3><p>Automate tenant onboarding using Azure Functions and Logic Apps.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fsharp data-lang=fsharp><span style=color:#66d9ef>let</span> tenantProvisioningFunction <span style=color:#f92672>=</span> functions <span style=color:#f92672>{</span>
    name <span style=color:#e6db74>&#34;tenant-provisioning&#34;</span>
    storage_account_name <span style=color:#e6db74>&#34;provisioningstorage&#34;</span>
    
    setting <span style=color:#e6db74>&#34;SqlConnectionString&#34;</span> multiTenantDatabase<span style=color:#f92672>.</span>ConnectionString <span style=color:#e6db74>&#34;shared-tenant-db&#34;</span>
    setting <span style=color:#e6db74>&#34;CosmosDbEndpoint&#34;</span> tenantRegistry<span style=color:#f92672>.</span>Endpoint
    
    <span style=color:#75715e>// Function triggered by new tenant sign-up
</span><span style=color:#75715e></span>    <span style=color:#75715e>// Implements provisioning workflow
</span><span style=color:#75715e></span><span style=color:#f92672>}</span>
</code></pre></div><p><strong>Provisioning Steps:</strong></p><ol><li>Validate tenant information</li><li>Create tenant record in Cosmos DB registry</li><li>Provision database schema or dedicated database</li><li>Create Key Vault for tenant secrets</li><li>Generate initial API keys</li><li>Configure DNS for custom domain</li><li>Send welcome email with credentials</li><li>Enable tenant in application</li></ol><p>Reference: Microsoft SaaS Fulfillment APIs (<a href=https://learn.microsoft.com/en-us/azure/marketplace/partner-center-portal/pc-saas-fulfillment-apis>https://learn.microsoft.com/en-us/azure/marketplace/partner-center-portal/pc-saas-fulfillment-apis</a>)</p><h3 id=monitoring-and-observability>Monitoring and Observability</h3><p>Implement per-tenant monitoring dashboards using Application Insights.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fsharp data-lang=fsharp><span style=color:#66d9ef>let</span> tenantMonitoring <span style=color:#f92672>=</span> appInsights <span style=color:#f92672>{</span>
    name <span style=color:#e6db74>&#34;tenant-monitoring&#34;</span>
    
    <span style=color:#75715e>// Workbook for per-tenant metrics
</span><span style=color:#75715e></span>    <span style=color:#75715e>// Configure via Azure Portal
</span><span style=color:#75715e></span><span style=color:#f92672>}</span>
</code></pre></div><p><strong>Key Metrics per Tenant:</strong></p><ul><li>Request count and latency</li><li>Error rate by tenant</li><li>Database query performance</li><li>API usage and throttling</li><li>Cost attribution</li><li>Active users per tenant</li></ul><h3 id=compliance-considerations>Compliance Considerations</h3><p>Multi-tenant SaaS applications must address compliance requirements per tenant.</p><p><strong>GDPR Compliance:</strong></p><ul><li>Implement data portability (export tenant data)</li><li>Support right to erasure (delete tenant data completely)</li><li>Maintain data processing records per tenant</li><li>Use EU regions for EU tenants (data residency)</li></ul><p><strong>HIPAA Compliance:</strong></p><ul><li>Sign Business Associate Agreement (BAA) with Microsoft</li><li>Use dedicated databases for healthcare tenants</li><li>Enable encryption at rest and in transit</li><li>Implement access controls and audit logging</li></ul><p><strong>SOC 2 Compliance:</strong></p><ul><li>Tenant data isolation verification</li><li>Regular penetration testing</li><li>Audit logging and retention</li><li>Incident response procedures</li></ul><h3 id=real-world-implementation-example>Real-World Implementation Example</h3><p>This pattern is used by successful Azure SaaS providers including Microsoft&rsquo;s own Dynamics 365 and Office 365.</p><p><strong>Case Study: Enterprise SaaS Platform</strong></p><p>A B2B SaaS company serving 500+ customers implemented hybrid multi-tenancy:</p><p><strong>Architecture:</strong></p><ul><li>450 small/medium customers: Shared Azure SQL with RLS</li><li>50 enterprise customers: Dedicated databases in elastic pool</li><li>Cosmos DB for tenant registry and configuration</li><li>Azure Front Door for global routing</li><li>Application Insights for per-tenant monitoring</li></ul><p><strong>Results:</strong></p><ul><li>60% cost reduction vs. full database-per-tenant</li><li>99.95% uptime SLA achieved</li><li>Sub-200ms global latency</li><li>Passed SOC 2 Type II audit</li><li>Scales to 1000+ customers without architecture changes</li></ul><h3 id=additional-resources>Additional Resources</h3><p><strong>Microsoft Official Documentation:</strong></p><ul><li>Multi-tenant SaaS database tenancy patterns: <a href=https://learn.microsoft.com/en-us/azure/azure-sql/database/saas-tenancy-app-design-patterns>https://learn.microsoft.com/en-us/azure/azure-sql/database/saas-tenancy-app-design-patterns</a></li><li>Azure Architecture Center - Multi-tenant SaaS: <a href=https://learn.microsoft.com/en-us/azure/architecture/guide/multitenant/>https://learn.microsoft.com/en-us/azure/architecture/guide/multitenant/</a></li><li>Row-Level Security: <a href=https://learn.microsoft.com/en-us/sql/relational-databases/security/row-level-security>https://learn.microsoft.com/en-us/sql/relational-databases/security/row-level-security</a></li></ul><p><strong>Microsoft Learn Paths:</strong></p><ul><li>Architect multi-tenant solutions on Azure: <a href=https://learn.microsoft.com/en-us/training/paths/architect-multitenant-solutions/>https://learn.microsoft.com/en-us/training/paths/architect-multitenant-solutions/</a></li></ul><p><strong>Community Resources:</strong></p><ul><li>Azure SaaS Development Kit (GitHub)</li><li>Azure MVP blog posts on multi-tenancy patterns</li><li>Microsoft Tech Community - Multi-tenant discussions</li></ul><p><strong>Books:</strong></p><ul><li>&ldquo;Designing Multi-Tenant SaaS Applications on Azure&rdquo; (Microsoft Press)</li><li>&ldquo;Cloud Native Applications on Azure&rdquo; by Jamie Maguire (O&rsquo;Reilly)</li></ul><p>This tutorial demonstrates proven multi-tenant patterns based on Microsoft&rsquo;s guidance and successful Azure customer implementations. Always validate your specific compliance and security requirements with legal and security teams before implementing multi-tenancy.</p><footer class=footline></footer></div></div><div id=navigation><a class="nav nav-prev" href=/farmer/tutorials/webapp-deploy/ title="Deploy an ASP.NET app"><i class="fa fa-chevron-left"></i></a><a class="nav nav-next" href=/farmer/tutorials/azure-cost-optimization/ title="Azure Cost Optimization Strategies" style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/farmer/js/clipboard.min.js?1764939374></script><script src=/farmer/js/perfect-scrollbar.min.js?1764939374></script><script src=/farmer/js/perfect-scrollbar.jquery.min.js?1764939374></script><script src=/farmer/js/jquery.sticky.js?1764939374></script><script src=/farmer/js/featherlight.min.js?1764939374></script><script src=/farmer/js/highlight.pack.js?1764939374></script><script>hljs.initHighlightingOnLoad();</script><script src=/farmer/js/modernizr.custom-3.6.0.js?1764939374></script><script src=/farmer/js/learn.js?1764939374></script><script src=/farmer/js/hugo-learn.js?1764939374></script><link href=/farmer/mermaid/mermaid.css?1764939374 rel=stylesheet><script src=/farmer/mermaid/mermaid.js?1764939374></script><script>mermaid.initialize({startOnLoad:true});</script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-72817248-3','auto');ga('send','pageview');</script></body></html>