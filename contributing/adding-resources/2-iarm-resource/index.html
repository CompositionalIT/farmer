<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.68.3"><meta name=description content="Farmer - Making repeatable Azure deployments easy!"><link rel=icon href=/farmer/images/farmer-favicon.png type=image/png><title>2. The IArmResource :: Farmer</title><link href=/farmer/css/nucleus.css?1675829657 rel=stylesheet><link href=/farmer/css/fontawesome-all.min.css?1675829657 rel=stylesheet><link href=/farmer/css/hybrid.css?1675829657 rel=stylesheet><link href=/farmer/css/featherlight.min.css?1675829657 rel=stylesheet><link href=/farmer/css/perfect-scrollbar.min.css?1675829657 rel=stylesheet><link href=/farmer/css/auto-complete.css?1675829657 rel=stylesheet><link href=/farmer/css/atom-one-dark-reasonable.css?1675829657 rel=stylesheet><link href=/farmer/css/theme.css?1675829657 rel=stylesheet><link href=/farmer/css/hugo-theme.css?1675829657 rel=stylesheet><link href=/farmer/css/theme-green.css?1675829657 rel=stylesheet><script src=/farmer/js/jquery-3.3.1.min.js?1675829657></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=/farmer/contributing/adding-resources/2-iarm-resource/><nav id=sidebar><div id=header-wrapper><div id=header><img src=/farmer/images/logo.png></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label><input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=/farmer/js/lunr.min.js?1675829657></script><script type=text/javascript src=/farmer/js/auto-complete.js?1675829657></script><script type=text/javascript>var baseurl="https:\/\/compositionalit.github.io\/farmer\/";</script><script type=text/javascript src=/farmer/js/search.js?1675829657></script></div><div class=highlightable><ul class=topics><li data-nav-id=/farmer/about/ title=About class=dd-item><a href=/farmer/about/>About</a></li><li data-nav-id=/farmer/quickstarts/ title=Quickstarts class=dd-item><a href=/farmer/quickstarts/>Quickstarts</a><ul><li data-nav-id=/farmer/quickstarts/quickstart-1/ title="Your first Farmer template" class=dd-item><a href=/farmer/quickstarts/quickstart-1/>Your first Farmer template</a></li><li data-nav-id=/farmer/quickstarts/quickstart-2/ title="Working with multiple resources" class=dd-item><a href=/farmer/quickstarts/quickstart-2/>Working with multiple resources</a></li><li data-nav-id=/farmer/quickstarts/quickstart-3/ title="Deploying to Azure" class=dd-item><a href=/farmer/quickstarts/quickstart-3/>Deploying to Azure</a></li><li data-nav-id=/farmer/quickstarts/template/ title="The Farmer .NET Template" class=dd-item><a href=/farmer/quickstarts/template/>The Farmer .NET Template</a></li></ul></li><li data-nav-id=/farmer/tutorials/ title=Tutorials class=dd-item><a href=/farmer/tutorials/>Tutorials</a><ul><li data-nav-id=/farmer/tutorials/traditional-ea/ title="Traditional Enterprise Application to the Azure Cloud, managed via Farmer" class=dd-item><a href=/farmer/tutorials/traditional-ea/>Traditional Enterprise Application to the Azure Cloud, managed via Farmer</a></li><li data-nav-id=/farmer/tutorials/webapp-deploy/ title="Deploy an ASP.NET app" class=dd-item><a href=/farmer/tutorials/webapp-deploy/>Deploy an ASP.NET app</a></li><li data-nav-id=/farmer/tutorials/custom-output/ title="Custom Output with ARM Expressions" class=dd-item><a href=/farmer/tutorials/custom-output/>Custom Output with ARM Expressions</a></li><li data-nav-id=/farmer/tutorials/keyvault-certs/ title="Declarative Steps in an ARM Deployment" class=dd-item><a href=/farmer/tutorials/keyvault-certs/>Declarative Steps in an ARM Deployment</a></li><li data-nav-id=/farmer/tutorials/minecraft-server-aci/ title="Create your own Minecraft Server" class=dd-item><a href=/farmer/tutorials/minecraft-server-aci/>Create your own Minecraft Server</a></li><li data-nav-id=/farmer/tutorials/aci-fsx/ title="F# Script in a Container Group" class=dd-item><a href=/farmer/tutorials/aci-fsx/>F# Script in a Container Group</a></li><li data-nav-id=/farmer/tutorials/cosmos-backed-webapp/ title="Cosmos-backed Web App" class=dd-item><a href=/farmer/tutorials/cosmos-backed-webapp/>Cosmos-backed Web App</a></li><li data-nav-id=/farmer/tutorials/multiple-web-apps/ title="Multiple web apps" class=dd-item><a href=/farmer/tutorials/multiple-web-apps/>Multiple web apps</a></li><li data-nav-id=/farmer/tutorials/serverless-etl/ title="Serverless ETL" class=dd-item><a href=/farmer/tutorials/serverless-etl/>Serverless ETL</a></li><li data-nav-id=/farmer/tutorials/web-storage-keyvault/ title="Web App Secrets with KeyVault" class=dd-item><a href=/farmer/tutorials/web-storage-keyvault/>Web App Secrets with KeyVault</a></li></ul></li><li data-nav-id=/farmer/api-overview/ title="API Overview" class=dd-item><a href=/farmer/api-overview/>API Overview</a><ul><li data-nav-id=/farmer/api-overview/template-generation/ title="Generating templates" class=dd-item><a href=/farmer/api-overview/template-generation/>Generating templates</a></li><li data-nav-id=/farmer/api-overview/expressions/ title="ARM Expressions" class=dd-item><a href=/farmer/api-overview/expressions/>ARM Expressions</a></li><li data-nav-id=/farmer/api-overview/parameters/ title="Parameters and Variables" class=dd-item><a href=/farmer/api-overview/parameters/>Parameters and Variables</a></li><li data-nav-id=/farmer/api-overview/basic-types/ title="Basic Types" class=dd-item><a href=/farmer/api-overview/basic-types/>Basic Types</a></li><li data-nav-id=/farmer/api-overview/dependencies/ title=Dependencies class=dd-item><a href=/farmer/api-overview/dependencies/>Dependencies</a></li><li data-nav-id=/farmer/api-overview/outputs/ title=Outputs class=dd-item><a href=/farmer/api-overview/outputs/>Outputs</a></li><li data-nav-id=/farmer/api-overview/resources/ title=Resources class=dd-item><a href=/farmer/api-overview/resources/>Resources</a><ul><li data-nav-id=/farmer/api-overview/resources/application-gateway/ title="Application Gateway" class=dd-item><a href=/farmer/api-overview/resources/application-gateway/>Application Gateway</a></li><li data-nav-id=/farmer/api-overview/resources/alert/ title="App Insights - Alerts" class=dd-item><a href=/farmer/api-overview/resources/alert/>App Insights - Alerts</a></li><li data-nav-id=/farmer/api-overview/resources/availability-tests/ title="App Insights - Availability Tests" class=dd-item><a href=/farmer/api-overview/resources/availability-tests/>App Insights - Availability Tests</a></li><li data-nav-id=/farmer/api-overview/resources/azure-firewall/ title="Azure Firewall" class=dd-item><a href=/farmer/api-overview/resources/azure-firewall/>Azure Firewall</a></li><li data-nav-id=/farmer/api-overview/resources/aks-cluster/ title="AKS Cluster" class=dd-item><a href=/farmer/api-overview/resources/aks-cluster/>AKS Cluster</a></li><li data-nav-id=/farmer/api-overview/resources/app-insights/ title="App Insights" class=dd-item><a href=/farmer/api-overview/resources/app-insights/>App Insights</a></li><li data-nav-id=/farmer/api-overview/resources/bing-search/ title="Bing Search" class=dd-item><a href=/farmer/api-overview/resources/bing-search/>Bing Search</a></li><li data-nav-id=/farmer/api-overview/resources/bastion-host/ title="Bastion Host" class=dd-item><a href=/farmer/api-overview/resources/bastion-host/>Bastion Host</a></li><li data-nav-id=/farmer/api-overview/resources/container-apps/ title="Container Apps" class=dd-item><a href=/farmer/api-overview/resources/container-apps/>Container Apps</a></li><li data-nav-id=/farmer/api-overview/resources/communication-services/ title="Communication Services" class=dd-item><a href=/farmer/api-overview/resources/communication-services/>Communication Services</a></li><li data-nav-id=/farmer/api-overview/resources/container-group/ title="Container Group" class=dd-item><a href=/farmer/api-overview/resources/container-group/>Container Group</a></li><li data-nav-id=/farmer/api-overview/resources/container-registry/ title="Container Registry" class=dd-item><a href=/farmer/api-overview/resources/container-registry/>Container Registry</a></li><li data-nav-id=/farmer/api-overview/resources/cognitive-services/ title="Cognitive Services" class=dd-item><a href=/farmer/api-overview/resources/cognitive-services/>Cognitive Services</a></li><li data-nav-id=/farmer/api-overview/resources/cosmos-db/ title="Cosmos DB" class=dd-item><a href=/farmer/api-overview/resources/cosmos-db/>Cosmos DB</a></li><li data-nav-id=/farmer/api-overview/resources/cdn/ title=CDN class=dd-item><a href=/farmer/api-overview/resources/cdn/>CDN</a></li><li data-nav-id=/farmer/api-overview/resources/dashboard/ title=Dashboard class=dd-item><a href=/farmer/api-overview/resources/dashboard/>Dashboard</a></li><li data-nav-id=/farmer/api-overview/resources/databricks-workspace/ title="Databricks Workspace" class=dd-item><a href=/farmer/api-overview/resources/databricks-workspace/>Databricks Workspace</a></li><li data-nav-id=/farmer/api-overview/resources/deployment-script/ title="Deployment Script" class=dd-item><a href=/farmer/api-overview/resources/deployment-script/>Deployment Script</a></li><li data-nav-id=/farmer/api-overview/resources/dns/ title="DNS Zone" class=dd-item><a href=/farmer/api-overview/resources/dns/>DNS Zone</a></li><li data-nav-id=/farmer/api-overview/resources/data-lake/ title="Data Lake" class=dd-item><a href=/farmer/api-overview/resources/data-lake/>Data Lake</a></li><li data-nav-id=/farmer/api-overview/resources/diagnosticsetting/ title="Diagnostic Settings" class=dd-item><a href=/farmer/api-overview/resources/diagnosticsetting/>Diagnostic Settings</a></li><li data-nav-id=/farmer/api-overview/resources/dedicated-hosts/ title="Dedicated Hosts" class=dd-item><a href=/farmer/api-overview/resources/dedicated-hosts/>Dedicated Hosts</a></li><li data-nav-id=/farmer/api-overview/resources/route-tables/ title="Route Tables" class=dd-item><a href=/farmer/api-overview/resources/route-tables/>Route Tables</a></li><li data-nav-id=/farmer/api-overview/resources/nat-gateway/ title="NAT Gateway" class=dd-item><a href=/farmer/api-overview/resources/nat-gateway/>NAT Gateway</a></li><li data-nav-id=/farmer/api-overview/resources/event-grid/ title="Event Grid" class=dd-item><a href=/farmer/api-overview/resources/event-grid/>Event Grid</a></li><li data-nav-id=/farmer/api-overview/resources/express-route/ title=ExpressRoute class=dd-item><a href=/farmer/api-overview/resources/express-route/>ExpressRoute</a></li><li data-nav-id=/farmer/api-overview/resources/event-hub/ title="Event Hub" class=dd-item><a href=/farmer/api-overview/resources/event-hub/>Event Hub</a></li><li data-nav-id=/farmer/api-overview/resources/functions/ title=Functions class=dd-item><a href=/farmer/api-overview/resources/functions/>Functions</a></li><li data-nav-id=/farmer/api-overview/resources/iot-hub/ title="IOT Hub" class=dd-item><a href=/farmer/api-overview/resources/iot-hub/>IOT Hub</a></li><li data-nav-id=/farmer/api-overview/resources/keyvault/ title="Key Vault" class=dd-item><a href=/farmer/api-overview/resources/keyvault/>Key Vault</a></li><li data-nav-id=/farmer/api-overview/resources/private-endpoint/ title="Private Endpoint" class=dd-item><a href=/farmer/api-overview/resources/private-endpoint/>Private Endpoint</a></li><li data-nav-id=/farmer/api-overview/resources/private-link-service/ title="Private Link Service" class=dd-item><a href=/farmer/api-overview/resources/private-link-service/>Private Link Service</a></li><li data-nav-id=/farmer/api-overview/resources/logic-apps/ title="Logic Apps" class=dd-item><a href=/farmer/api-overview/resources/logic-apps/>Logic Apps</a></li><li data-nav-id=/farmer/api-overview/resources/load-balancer/ title="Load Balancer" class=dd-item><a href=/farmer/api-overview/resources/load-balancer/>Load Balancer</a></li><li data-nav-id=/farmer/api-overview/resources/loganalytics/ title="Log Analytics" class=dd-item><a href=/farmer/api-overview/resources/loganalytics/>Log Analytics</a></li><li data-nav-id=/farmer/api-overview/resources/managed-identity/ title="Managed Identity" class=dd-item><a href=/farmer/api-overview/resources/managed-identity/>Managed Identity</a></li><li data-nav-id=/farmer/api-overview/resources/maps/ title=Maps class=dd-item><a href=/farmer/api-overview/resources/maps/>Maps</a></li><li data-nav-id=/farmer/api-overview/resources/nsg/ title="Network Security Group" class=dd-item><a href=/farmer/api-overview/resources/nsg/>Network Security Group</a></li><li data-nav-id=/farmer/api-overview/resources/operations-management/ title="Operations Management" class=dd-item><a href=/farmer/api-overview/resources/operations-management/>Operations Management</a></li><li data-nav-id=/farmer/api-overview/resources/postgresql/ title=PostgreSQL class=dd-item><a href=/farmer/api-overview/resources/postgresql/>PostgreSQL</a></li><li data-nav-id=/farmer/api-overview/resources/redis/ title="Redis Cache" class=dd-item><a href=/farmer/api-overview/resources/redis/>Redis Cache</a></li><li data-nav-id=/farmer/api-overview/resources/resource-group/ title="Resource Group" class=dd-item><a href=/farmer/api-overview/resources/resource-group/>Resource Group</a></li><li data-nav-id=/farmer/api-overview/resources/signalr/ title=SignalR class=dd-item><a href=/farmer/api-overview/resources/signalr/>SignalR</a></li><li data-nav-id=/farmer/api-overview/resources/search/ title=Search class=dd-item><a href=/farmer/api-overview/resources/search/>Search</a></li><li data-nav-id=/farmer/api-overview/resources/service-bus/ title="Service Bus" class=dd-item><a href=/farmer/api-overview/resources/service-bus/>Service Bus</a></li><li data-nav-id=/farmer/api-overview/resources/sql/ title="SQL Azure" class=dd-item><a href=/farmer/api-overview/resources/sql/>SQL Azure</a></li><li data-nav-id=/farmer/api-overview/resources/static-web-app/ title="Static Web Apps" class=dd-item><a href=/farmer/api-overview/resources/static-web-app/>Static Web Apps</a></li><li data-nav-id=/farmer/api-overview/resources/storage-account/ title="Storage Account" class=dd-item><a href=/farmer/api-overview/resources/storage-account/>Storage Account</a></li><li data-nav-id=/farmer/api-overview/resources/traffic-manager/ title="Traffic Manager" class=dd-item><a href=/farmer/api-overview/resources/traffic-manager/>Traffic Manager</a></li><li data-nav-id=/farmer/api-overview/resources/virtual-machine/ title="Virtual Machine" class=dd-item><a href=/farmer/api-overview/resources/virtual-machine/>Virtual Machine</a></li><li data-nav-id=/farmer/api-overview/resources/virtual-hub/ title="Virtual Hub" class=dd-item><a href=/farmer/api-overview/resources/virtual-hub/>Virtual Hub</a></li><li data-nav-id=/farmer/api-overview/resources/vnet/ title="Virtual Network" class=dd-item><a href=/farmer/api-overview/resources/vnet/>Virtual Network</a></li><li data-nav-id=/farmer/api-overview/resources/virtual-wan/ title="Virtual WAN" class=dd-item><a href=/farmer/api-overview/resources/virtual-wan/>Virtual WAN</a></li><li data-nav-id=/farmer/api-overview/resources/vnet-gateway/ title="Virtual Network Gateway" class=dd-item><a href=/farmer/api-overview/resources/vnet-gateway/>Virtual Network Gateway</a></li><li data-nav-id=/farmer/api-overview/resources/web-app/ title="Web App" class=dd-item><a href=/farmer/api-overview/resources/web-app/>Web App</a></li></ul></li></ul></li><li data-nav-id=/farmer/arm-vs-farmer/ title="Farmer and ARM" class=dd-item><a href=/farmer/arm-vs-farmer/>Farmer and ARM</a></li><li data-nav-id=/farmer/deployment-guidance/ title="Deployment Guidance" class=dd-item><a href=/farmer/deployment-guidance/>Deployment Guidance</a></li><li data-nav-id=/farmer/support/ title="Commercial Support" class=dd-item><a href=/farmer/support/>Commercial Support</a></li><li data-nav-id=/farmer/testimonials/ title=Testimonials class=dd-item><a href=/farmer/testimonials/>Testimonials</a></li><li data-nav-id=/farmer/links/ title=Links class=dd-item><a href=/farmer/links/>Links</a></li><li data-nav-id=/farmer/contributing/ title=Contributing class="dd-item
parent"><a href=/farmer/contributing/>Contributing</a><ul><li data-nav-id=/farmer/contributing/arm-basics/ title="ARM Basics" class=dd-item><a href=/farmer/contributing/arm-basics/>ARM Basics</a></li><li data-nav-id=/farmer/contributing/outputs-and-expressions/ title="Outputs and ARM Expressions" class=dd-item><a href=/farmer/contributing/outputs-and-expressions/>Outputs and ARM Expressions</a></li><li data-nav-id=/farmer/contributing/create-pull-requests/ title="Creating Pull Requests" class=dd-item><a href=/farmer/contributing/create-pull-requests/>Creating Pull Requests</a></li><li data-nav-id=/farmer/contributing/adding-resources/ title="Supporting a new ARM Resource" class="dd-item
parent"><a href=/farmer/contributing/adding-resources/>Supporting a new ARM Resource</a><ul><li data-nav-id=/farmer/contributing/adding-resources/1-the-farmer-pipline/ title="1. The Farmer Pipeline" class=dd-item><a href=/farmer/contributing/adding-resources/1-the-farmer-pipline/>1. The Farmer Pipeline</a></li><li data-nav-id=/farmer/contributing/adding-resources/2-iarm-resource/ title="2. The IArmResource" class="dd-item active"><a href=/farmer/contributing/adding-resources/2-iarm-resource/>2. The IArmResource</a></li><li data-nav-id=/farmer/contributing/adding-resources/3-ibuilder/ title="3. The IBuilder interface" class=dd-item><a href=/farmer/contributing/adding-resources/3-ibuilder/>3. The IBuilder interface</a></li><li data-nav-id=/farmer/contributing/adding-resources/4-creating-builder-syntax/ title="4. Providing Builder syntax" class=dd-item><a href=/farmer/contributing/adding-resources/4-creating-builder-syntax/>4. Providing Builder syntax</a></li><li data-nav-id=/farmer/contributing/adding-resources/5-unit-testing/ title="5. Unit Testing" class=dd-item><a href=/farmer/contributing/adding-resources/5-unit-testing/>5. Unit Testing</a></li></ul></li></ul></li><li data-nav-id=/farmer/faq/ title=FAQs class=dd-item><a href=/farmer/faq/>FAQs</a></li></ul><section id=shortcuts><h3>More</h3><ul><li><a class=padding href=https://github.com/compositionalit/farmer><i class="fab fa-fw fa-github"></i>GitHub repo</a></li><li><a class=padding href=https://www.nuget.org/packages/Farmer/><i class="fab fa-fw fa-microsoft"></i>Nuget</a></li><li><a class=padding href=https://compositional-it.com><img src=/farmer/images/cit.png></img> Compositional IT</a></li></ul></section><section id=footer></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=top-github-link><a class=github-link title="Edit this page" href=https://github.com/CompositionalIT/farmer/tree/master/docs/content/contributing/adding-resources/2-iarm-resource.md target=blank><i class="fas fa-code-branch"></i><span id=top-github-link-text>Edit this page</span></a></div><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i></a></span><span id=toc-menu><i class="fas fa-list-alt"></i></span><span class=links><a href=/farmer/>Farmer</a> > <a href=/farmer/contributing/>Contributing</a> > <a href=/farmer/contributing/adding-resources/>Supporting a new ARM Resource</a> > 2. The IArmResource</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><ul><li><a href=#step-21-migrating-to-iarmresource>Step 2.1: Migrating to IArmResource</a></li><li><a href=#step-22-generating-the-arm-values-more-quickly>Step 2.2: Generating the ARM values more quickly</a></li><li><a href=#step-23-move-domain-types-out-of-the-iarmbuilder>Step 2.3: Move domain types out of the IArmBuilder.</a></li><li><a href=#step-24-test-out-the-new-registries-record-in-farmer>Step 2.4: Test out the new Registries record in Farmer.</a></li></ul></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>2. The IArmResource</h1><p>In this exercise, we&rsquo;ll migrate our code from the previous step directly into the Farmer codebase.</p><h3 id=step-21-migrating-to-iarmresource>Step 2.1: Migrating to IArmResource</h3><p>Now that you know that your resource model produces the correct Json value when passed into Farmer, we can now create a proper type that contains the &ldquo;parameterised&rdquo; parts of the above function, such as <code>name</code>, <code>sku</code> and <code>adminUserEnabled</code>, and properly takes part in the Farmer pipeline, by implementing the <code>IArmResource</code> interface. This type is normally a full <a href=https://docs.microsoft.com/en-us/dotnet/fsharp/language-reference/records>Record</a> and should use types as required to capture e.g. SKUs or other elements that would benefit from typing (in the example above, <code>sku</code> is a string, but we will shortly replace that with a union type).</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fsharp data-lang=fsharp><span style=color:#75715e>// src/Farmer/Arm/ContainerRegistry.fs
</span><span style=color:#75715e></span><span style=color:#f92672>[&lt;</span>AutoOpen<span style=color:#f92672>&gt;]</span>
<span style=color:#66d9ef>module</span> Farmer.Arm.ContainerRegistry

<span style=color:#66d9ef>open</span> Farmer

<span style=color:#75715e>// Create a reference to the full ARM registries type and version.
</span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> registries <span style=color:#f92672>=</span> ResourceType <span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Microsoft.ContainerRegistry/registries&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;2019-05-01&#34;</span><span style=color:#f92672>)</span>

<span style=color:#75715e>// Temporarily define the SKU and other types alongside the IArmResource.
</span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Sku</span> <span style=color:#f92672>=</span>
    <span style=color:#f92672>|</span> Basic
    <span style=color:#f92672>|</span> Standard
    <span style=color:#f92672>|</span> Premium

<span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Registries</span> <span style=color:#f92672>=</span>
    <span style=color:#f92672>{</span> Name <span style=color:#f92672>:</span> ResourceName
      Location <span style=color:#f92672>:</span> Location
      Sku <span style=color:#f92672>:</span> Sku
      AdminUserEnabled <span style=color:#f92672>:</span> <span style=color:#66d9ef>bool</span> <span style=color:#f92672>}</span>
    <span style=color:#66d9ef>interface</span> IArmResource <span style=color:#66d9ef>with</span>
        <span style=color:#66d9ef>member</span> this.<span style=color:#a6e22e>ResourceId</span> <span style=color:#f92672>=</span> registries<span style=color:#f92672>.</span>resourceId this<span style=color:#f92672>.</span>Name
        <span style=color:#66d9ef>member</span> this.<span style=color:#a6e22e>JsonModel</span> <span style=color:#f92672>=</span>
            <span style=color:#f92672>{|</span> name <span style=color:#f92672>=</span> this<span style=color:#f92672>.</span>Name<span style=color:#f92672>.</span>Value
               ``type`` <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Microsoft.ContainerRegistry/registries&#34;</span>
               apiVersion <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;2019-05-01&#34;</span>
               sku <span style=color:#f92672>=</span> <span style=color:#f92672>{|</span> name <span style=color:#f92672>=</span> this<span style=color:#f92672>.</span>Sku<span style=color:#f92672>.</span>ToString() <span style=color:#f92672>|}</span>
               location <span style=color:#f92672>=</span> this<span style=color:#f92672>.</span>Location<span style=color:#f92672>.</span>ArmValue
               tags <span style=color:#f92672>=</span> <span style=color:#f92672>{||}</span>
               properties <span style=color:#f92672>=</span> <span style=color:#f92672>{|</span> adminUserEnabled <span style=color:#f92672>=</span> this<span style=color:#f92672>.</span>AdminUserEnabled <span style=color:#f92672>|}</span>
            <span style=color:#f92672>|}</span> <span style=color:#f92672>:&gt;</span> <span style=color:#f92672>_</span> <span style=color:#75715e>// upcast to obj
</span></code></pre></div><p>Notice how we perform simple &ldquo;serialization&rdquo; of elements such as the SKU, but otherwise most fields are just copied across.</p><p>The biggest difference is that we have now also introduced the notion of <code>ResourceType</code> and <code>ResourceId</code>. A <code>ResourceType</code> allows you to specify the versioned ARM type that your resource implements; a <code>ResourceId</code> represents the qualified path to a specific, named resource. It contains at least the resource&rsquo;s type and its name, but can also optionally include e.g. the resource group that the resource belongs to.</p><h3 id=step-22-generating-the-arm-values-more-quickly>Step 2.2: Generating the ARM values more quickly</h3><p>Because most ARM resources have a set of fields that are commonly used e.g. name, location etc., Farmer comes with a helper factory function to construct ARM JSON objects quickly and easily. Here&rsquo;s a shortened version of <code>JsonModel</code> above:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fsharp data-lang=fsharp><span style=color:#f92672>{|</span> registries<span style=color:#f92672>.</span>Create<span style=color:#f92672>(</span>this<span style=color:#f92672>.</span>Name<span style=color:#f92672>,</span> this<span style=color:#f92672>.</span>Location<span style=color:#f92672>)</span> <span style=color:#66d9ef>with</span>
        sku <span style=color:#f92672>=</span> <span style=color:#f92672>{|</span> name <span style=color:#f92672>=</span> this<span style=color:#f92672>.</span>Sku<span style=color:#f92672>.</span>ToString() <span style=color:#f92672>|}</span>
        properties <span style=color:#f92672>=</span> <span style=color:#f92672>{|</span> adminUserEnabled <span style=color:#f92672>=</span> this<span style=color:#f92672>.</span>AdminUserEnabled <span style=color:#f92672>|}</span>
<span style=color:#f92672>|}</span> <span style=color:#f92672>:&gt;</span> <span style=color:#f92672>_</span> <span style=color:#75715e>// upcast to obj
</span></code></pre></div><p>Now, the common fields will be generated for us through the <code>registies.Create</code> function; any custom fields (such as <code>sku</code> and <code>properties</code>) are then applied on top.</p><h3 id=step-23-move-domain-types-out-of-the-iarmbuilder>Step 2.3: Move domain types out of the IArmBuilder.</h3><blockquote><p>You can skip this step if you&rsquo;re just experimenting in e.g. a script.</p></blockquote><p>For now, we&rsquo;ve created any associated types such as <code>Sku</code> directly above the file, but you&rsquo;ll want to migrate these to a <code>Farmer.ContainerRegistry</code> module in <code>Common.fs</code> afterwards e.g.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fsharp data-lang=fsharp><span style=color:#75715e>// src/Farmer/Common.fs
</span><span style=color:#75715e></span><span style=color:#66d9ef>namespace</span> Farmer

<span style=color:#66d9ef>module</span> ContainerRegistry <span style=color:#f92672>=</span>
    <span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Sku</span> <span style=color:#f92672>=</span>
    <span style=color:#f92672>|</span> Basic
    <span style=color:#f92672>|</span> Standard
    <span style=color:#f92672>|</span> Premium
</code></pre></div><h3 id=step-24-test-out-the-new-registries-record-in-farmer>Step 2.4: Test out the new Registries record in Farmer.</h3><p>You can test this again easily by passing an instance into a Farmer deployment like we did in the previous step:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fsharp data-lang=fsharp><span style=color:#66d9ef>open</span> Farmer.Arm.ContainerRegistry
<span style=color:#66d9ef>let</span> registries <span style=color:#f92672>=</span>
    <span style=color:#f92672>{</span> Name <span style=color:#f92672>=</span> ResourceName <span style=color:#e6db74>&#34;my-registry&#34;</span>
      Location <span style=color:#f92672>=</span> Location.WestEurope
      Sku <span style=color:#f92672>=</span> ContainerRegistry.Basic
      AdminUserEnabled <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span> <span style=color:#f92672>}</span>

<span style=color:#66d9ef>let</span> deployment <span style=color:#f92672>=</span> arm <span style=color:#f92672>{</span>
    location Location.NorthEurope
    add_resource registries
<span style=color:#f92672>}</span>

deployment
<span style=color:#f92672>|&gt;</span> Writer.quickWrite <span style=color:#e6db74>&#34;output&#34;</span>
</code></pre></div><blockquote><p>Note that F# records must be completely filled at creation, so you must provide values for all four fields.</p></blockquote><p>You could now write a test to assert the Json structure. Most tests in the project though tend to test from the Farmer builders, which we will get to soon. You can stop right here if you want - what you&rsquo;ve done so far allows you to create <code>IArmResource</code> objects which can be added to the Farmer pipeline. However, we will go further in the next exericse and make it even easier to create Container Registries by creating an <strong>IBuilder</strong>.</p><footer class=footline></footer></div></div><div id=navigation><a class="nav nav-prev" href=/farmer/contributing/adding-resources/1-the-farmer-pipline/ title="1. The Farmer Pipeline"><i class="fa fa-chevron-left"></i></a><a class="nav nav-next" href=/farmer/contributing/adding-resources/3-ibuilder/ title="3. The IBuilder interface" style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/farmer/js/clipboard.min.js?1675829657></script><script src=/farmer/js/perfect-scrollbar.min.js?1675829657></script><script src=/farmer/js/perfect-scrollbar.jquery.min.js?1675829657></script><script src=/farmer/js/jquery.sticky.js?1675829657></script><script src=/farmer/js/featherlight.min.js?1675829657></script><script src=/farmer/js/highlight.pack.js?1675829657></script><script>hljs.initHighlightingOnLoad();</script><script src=/farmer/js/modernizr.custom-3.6.0.js?1675829657></script><script src=/farmer/js/learn.js?1675829657></script><script src=/farmer/js/hugo-learn.js?1675829657></script><link href=/farmer/mermaid/mermaid.css?1675829657 rel=stylesheet><script src=/farmer/mermaid/mermaid.js?1675829657></script><script>mermaid.initialize({startOnLoad:true});</script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-72817248-3','auto');ga('send','pageview');</script></body></html>